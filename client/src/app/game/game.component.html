<h1>Hanabi</h1>
<div *ngIf="logic; else gameLoading" class="w-100 h-100">
  <p class="tokens">
    <span class="note">Note tokens: <strong>{{logic.noteTokens}}</strong></span><br />
    <span class="storm">Storm tokens: <strong>{{logic.stormTokens}}</strong></span>
  </p>
  <div class="w-100 d-flex flex-row players">
    <div *ngFor="let player of logic.players" class="flex-grow-1 p-3" [class.active]="player === logic.activePlayer">
      <h3>{{player.name}}</h3>
      <div class="d-flex flex-column cards">
        <ng-container *ngFor="let card of player.cards">
          <div class="d-flex flex-row justify-content-center align-items-center card"
            [class]="getCardBackgroundClass(player, card)" [ngbPopover]="popContent" popoverTitle="Actions">
            <strong class="description">
              {{ getCardDescription(player, card) }}
            </strong>
          </div>
          <ng-template #popContent>
            <div class="d-flex flex-row justify-content-center align-items-center">
              <ng-container *ngIf="player === logic.activePlayer; else otherPlayersContent">
                <button class="btn btn-sm btn-light action" (click)="player.playCard(card)">Play</button>
                <button class="btn btn-sm btn-secondary action" (click)="player.discardCard(card)">Discard</button>
              </ng-container>

              <ng-template #otherPlayersContent>
                <button class="btn btn-sm btn-primary action" *ngIf="!isColorful(card.color); else allColorActions"
                  [class]="getCardBackgroundClass(player, card)"
                  (click)="logic.activePlayer.giveHint(player, card, card.color)">Hint color {{card.color}}</button>
                <ng-template #allColorActions>
                  <div class="d-flex flex-column">
                    <button *ngFor="let color of allSingleColors" class="btn btn-sm btn-primary action" [class]="color"
                      (click)="logic.activePlayer.giveHint(player, card, color)">Hint {{color}}</button>
                  </div>
                </ng-template>
                <button class="btn btn-sm btn-secondary action"
                  (click)="logic.activePlayer.giveHint(player, card, card.number)">Hint
                  number
                  {{card.number}}</button>
              </ng-template>
            </div>
          </ng-template>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<ng-template #gameLoading>
  <div class="flex-grow-1 d-flex flex-column justify-content-center">
    <div class="d-flex flex-column align-items-center">
      <ng-container *ngIf="gameOverReason; else landingPage">
        <h3>Game over</h3>
        <p>{{gameOverReason.message}}</p>
        <button class="btn btn-lg btn-primary" (click)="start()">Play again</button>
      </ng-container>

      <ng-template #landingPage>
        <h3>Would you like to</h3>
    <button class="btn btn-lg btn-primary" (click)="start()">Play?</button>
      </ng-template>
    </div>
  </div>
</ng-template>