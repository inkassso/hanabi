<ng-container *ngIf="player; else loading">
  <h4>{{ player.name }}</h4>
  <div class="d-flex flex-column position-relative hand">
    <div *ngFor="let card of player.cards; let i = index" class="card-wrapper" [class.flipped]="card === flipped"
      @slideLeftLiftUp>
      <app-card [card]="card" [isFlipped]="isActive && card !== flipped" [flipDelay]="getFlipDelay(i)"
        [ngbPopover]="popContent" [popoverTitle]="popTitle" popoverClass="w-200 shadow" autoClose="outside"
        [disablePopover]="isCardDisabled(card)" [placement]="popoverPlacement" triggers="manual" #popover="ngbPopover"
        (click)="popover.open()" [attr.role]="isCardDisabled(card) ? undefined : 'button'">
      </app-card>

      <ng-template #popTitle>
        <div [ngSwitch]="true" class="d-flex justify-content-around align-items-center">
          <ng-container *ngSwitchCase="isActive" [ngSwitch]="true">
            <span *ngSwitchCase="card === flipped && isColorful(card.color)">Select Firework Color</span>
            <span *ngSwitchDefault>Select Action</span>
          </ng-container>
          <span *ngSwitchDefault>Give Hint</span>
        </div>
      </ng-template>
      <ng-template #popContent>
        <div class="d-flex flex-row justify-content-around align-items-center" [ngSwitch]="true">
          <ng-container *ngSwitchCase="isActive" [ngSwitch]="true">
            <div *ngSwitchCase="card === flipped && isColorful(card.color)" class="d-flex flex-column">
              <!-- TODO show only colors which are applicable, error otherwise -->
              <button *ngFor="let color of allSingleColors" class="btn btn-sm action" [class]="getButtonClass(color)"
                (click)="playFlippedColorful(color); popover.close()">
                Color {{color}}
              </button>
            </div>
            <ng-container *ngSwitchDefault>
              <button class="btn btn-sm btn-light action" (click)="playCard(card) && popover.close()">Play</button>
              <button class="btn btn-sm btn-secondary action"
                (click)="discardCard(card); popover.close()">Discard</button>
            </ng-container>
          </ng-container>

          <ng-container *ngSwitchDefault>
            <button class="btn btn-sm action" *ngIf="!isColorful(card.color); else allColorActions"
              [class]="getButtonClass(card.color)" (click)="notifyGiveHintRequest(card, card.color); popover.close()">
              Color {{card.color}}
            </button>
            <ng-template #allColorActions>
              <div class="d-flex flex-column">
                <button *ngFor="let color of allSingleColors" class="btn btn-sm action" [class]="getButtonClass(color)"
                  (click)="notifyGiveHintRequest(card, color); popover.close()">
                  Color {{color}}
                </button>
              </div>
            </ng-template>
            <button class="btn btn-sm btn-secondary action"
              (click)="popover.close(); notifyGiveHintRequest(card, card.number)">
              Number {{card.number}}
            </button>
          </ng-container>
        </div>
      </ng-template>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <span class="fs-4">Loading...</span>
</ng-template>
